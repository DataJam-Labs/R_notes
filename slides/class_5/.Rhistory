predict(mlogit_vote_sq_sex, type="probs") %>% # prob predichas cada obs.
pivot_longer(everything(), names_to="vote", values_to="prob")
predict(mlogit_vote_sq_sex, type="probs")
predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble() %>% # prob predichas cada obs.
pivot_longer(everything(), names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>%
pivot_longer(everything(), names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>%
pivot_longer(everything(), names_to="vote", values_to="prob")
p_hat_delta
p_hat_delta %>% left_join(p_hat, by="vote")
p_hat_delta <- p_hat_delta %>% mutate(me_sq = p_hat_delta  - p_hat)/delta # approx. numerica marginal effect.
p_hat_delta <- p_hat_delta %>% mutate(me_sq = prob_delta  - prob)/delta # approx. numerica marginal effect.
p_hat_delta <- p_hat_delta %>% mutate(me_sq = (prob_delta  - prob)/delta) # approx. numerica marginal effect.
p_hat_delta
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by="vote")
p_hat_delta %>% mutate(me_sq = (prob_delta  - prob)/delta)
p_hat_delta <- p_hat_delta %>% mutate(me_sq = (prob_delta  - prob)/delta)
# average marginal effect
round(mean(p_hat_delta$me_sq),4)
p_hat_delta
mean(p_hat_delta$me_sq)
p_hat_delta %>% pivot_wider(names_from = "vote", values_from = "prob")
p_hat_delta %>% select(vote,me_sq)
p_hat_delta
p_hat_delta %>% dplyr::select(vote,me_sq)
p_hat_delta %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "prob")
p_hat_delta %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% dplyr::select(vote,me_sq)
p_hat_delta %>% mutate(a=1) %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% dplyr::select(vote,me_sq)
p_hat_delta %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% mutate(id = row_number()) %>% dplyr::select(vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% mutate(id = row_number())
p_hat_delta %>% mutate(id = row_number()) %>% select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% mutate(id = row_number()) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta %>% mutate(id = row_number()) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% View()
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble() %>% # prob predichas cada obs.
pivot_longer(everything(), names_to="vote", values_to="prob") %>% mutate(id = row_number())
p_hat
predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number())
predict(mlogit_vote_sq_sex, type="probs")  %>% mutate(id = row_number())
predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(everything(), names_to="vote", values_to="prob")
predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by="id")
p_hat_delta
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.01 # cantidad cambio
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta) # cambio marginal en ym
# probabilidad predicha con ym aumentado marginalmente
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote"))
p_hat_delta
p_hat_delta <- p_hat_delta %>% mutate(me_sq = (prob_delta  - prob)/delta) # approx. numerica marginal effect.
p_hat_delta
p_hat_delta <- p_hat_delta  %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta
summarise(across(A:Y, ame_sq= ~mean(.x,na.rm =TRUE)))
# average marginal effect
p_hat_delta %>% summarise(across(A:Y, ame_sq= ~mean(.x,na.rm =TRUE)))
# average marginal effect
p_hat_delta %>% summarise(across(-id, ame_sq= ~ mean(.x,na.rm =TRUE)))
# average marginal effect
p_hat_delta %>% dplyr::summarise(across(-id, ame_sq= ~ mean(.x,na.rm =TRUE)))
# average marginal effect
p_hat_delta %>% summarise(mean(A, na.rm=T))
# average marginal effect
p_hat_delta %>% dplyr::summarise(across(-id, ame_sq = list( ~mean(.x,na.rm =TRUE))) )
# average marginal effect
p_hat_delta %>% dplyr::summarize(across(-id, ame_sq = list( ~mean(.x,na.rm =TRUE))) )
# average marginal effect
p_hat_delta %>% ungroup() %>% dplyr::summarize(across(-id, ame_sq = list( ~mean(.x,na.rm =TRUE))) )
# average marginal effect
summary(p_hat_delta)
# average marginal effect
summary(p_hat_delta %>% select(-id))
# average marginal effect
summary(p_hat_delta %>% dplyr::select(-id))
# average marginal effect
mean(p_hat_delta %>% dplyr::select(-id))
# average marginal effect
mean(p_hat_delta %>% dplyr::select(-id), na.rm=T)
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.01
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq")
p_hat_delta
# average marginal effect
apply(p_hat_delta, 2, mean)
p_hat_delta %>% filter(is.na(A)==T)
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
p_hat
p_hat_delta
View(p_hat_delta)
plebs_1988
plebs_1988 %>% View()
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.01
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
apply(p_hat_delta, 2, mean)
p_hat_delta
p_hat_delta %>% summarise(across(A:Y))
p_hat_delta %>% summarise(across(A:Y), n())
p_hat_delta %>% summarise(across(A:Y), ~mean(.x))
p_hat_delta %>% summarise(across(A:Y), ~ mean(.x))
p_hat_delta %>% dplyr__summarise(across(A:Y), ~ mean(.x))
p_hat_delta %>% dplyr::summarise(across(A:Y), ~ mean(.x))
dplyr::summarise(p_hat_delta,across(A:Y), ~ mean(.x))
p_hat_delta %>% dplyr::summarise( across(A:Y, ~ mean(.x))
p_hat_delta %>% dplyr::summarise( across(A:Y, ~ mean(.x)))
p_hat_delta %>% dplyr::summarise( across(A:Y, ~ mean(.x)))
p_hat_delta %>% dplyr::summarise( across(A:Y, ~ mean(.x)))
xaringan:::inf_mr()
?margins
xaringan:::inf_mr()
summary(margins(mlogit_vote_sq_sex, variables = "statusquo"))
marginal_effects(mlogit_vote_sq_sex)
mean(marginal_effects(mlogit_vote_sq_sex))[1]
mean(marginal_effects(mlogit_vote_sq_sex))[,1]
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
table(plebs_1988_delta$vote)
table(plebs_1988_delta$vote)/sum(plebs_1988_delta$vote)
table(plebs_1988_delta$vote)/sum(table(plebs_1988_delta$vote))
0.0306*0.07385466 + -0.159*0.35110585 + 0.0553*0.23222749 + 0.0730*0.34281201
0.0306  + -0.159 + 0.0553 + 0.0730
(0.0306  + -0.159 + 0.0553 + 0.0730)/4
predictions <- predictions %>% filter(str_detect(quant, "^p")) %>% separate(quant,sep="_", into=c("quant","vote"))
coefs <- summary(mlogit_vote_sq_sex)$coefficients %>% as_tibble() %>% mutate(vote = c("N","U","Y")) %>%
rename(beta_0 = `(Intercept)`, beta_sq = statusquo, beta_sex = sexM)
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq))
grid <- plebs_1988  %>% data_grid(statusquo=seq_range(statusquo,30),sex,.model=mlogit_vote_sq_sex)
predictions <- cbind(grid,predict(mlogit_vote_sq_sex, newdata=grid, type="prob")) %>%
pivot_longer(-c(statusquo,sex), names_to="outcome",values_to="p" ) %>%
mutate(p_outcome = paste0("p_",outcome)) %>% dplyr::select(-outcome) %>%
pivot_wider(names_from = p_outcome, values_from=p) %>%
mutate(across(p_N:p_Y, ~  log(.x/p_A), .names = "logit_{.col}" )) %>%
mutate(across(logit_p_N:logit_p_Y, ~  exp(.x), .names = "or_{.col}" )) %>%
pivot_longer(-c(statusquo,sex), names_to="quant", values_to="est")
predictions %>% filter(str_detect(quant, "^p")) %>% separate(quant,sep="_", into=c("quant","vote")) %>%
ggplot(aes(x=statusquo, y=est, colour=vote, group=interaction(vote,sex))) +
geom_path(aes(linetype=sex), alpha=0.5, size=1.5) +
scale_color_viridis_d() +  scale_fill_viridis_d() +
theme(axis.text.y = element_text(size = 22), axis.text.x = element_text(size = 22),
axis.title.y = element_text(size = 24), axis.title.x = element_text(size = 24),
legend.text = element_text(size = 18), legend.position="top") +
labs(x="Support status-quo", y="P(vote=j)")
predictions <- predictions %>% filter(str_detect(quant, "^p")) %>% separate(quant,sep="_", into=c("quant","vote"))
predictions
coefs <- summary(mlogit_vote_sq_sex)$coefficients %>% as_tibble() %>% mutate(vote = c("N","U","Y")) %>%
rename(beta_0 = `(Intercept)`, beta_sq = statusquo, beta_sex = sexM)
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq)) %>%
summarise(mean(me_sq,na.rm=T))
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq))
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq)) %>%
group_by(vote) %>%
summarise(mean(me_sq,na.rm=T))
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.02
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.005
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.001
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
p_hat <- predict(mlogit_vote_sq_sex, type="probs") %>% as_tibble()  %>% mutate(id = row_number()) %>%
pivot_longer(-id, names_to="vote", values_to="prob")
delta = 0.1
plebs_1988_delta <- plebs_1988 %>% mutate(statusquo = statusquo + delta)
p_hat_delta <- predict(mlogit_vote_sq_sex, newdata=plebs_1988_delta ,type="probs")  %>% #prob predichas cada obs.
as_tibble() %>% mutate(id = row_number()) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta %>% dplyr::summarise(across(A:Y, ~ mean(.x)))# average marginal effect
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq)) %>%
group_by(vote) %>%
summarise(mean(me_sq,na.rm=T))
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq))
ggplot(aes(x=statusquo, y=me_sq, colour=vote, group=interaction(vote,sex))) +
geom_path(aes(linetype=sex), alpha=0.5, size=1.5) +
scale_color_viridis_d() +  scale_fill_viridis_d() +
theme(axis.text.y = element_text(size = 22), axis.text.x = element_text(size = 22),
axis.title.y = element_text(size = 24), axis.title.x = element_text(size = 24),
legend.text = element_text(size = 18), legend.position="top") +
labs(x="Support status-quo", y="Efecto marginal de status quo") +
geom_hline(yintercept = 0, size=1.5)
predictions %>% left_join(coefs, by="vote") %>%
replace_na(list(beta_0 = 0, beta_sq = 0, beta_sex = 0)) %>%
mutate(beta_sq_prob = beta_sq*est) %>% group_by(statusquo,sex) %>%
mutate(average_beta_sq = sum(beta_sq_prob, na.rm = T)) %>%
ungroup() %>% mutate(me_sq = est*(beta_sq -average_beta_sq)) %>%
ggplot(aes(x=statusquo, y=me_sq, colour=vote, group=interaction(vote,sex))) +
geom_path(aes(linetype=sex), alpha=0.5, size=1.5) +
scale_color_viridis_d() +  scale_fill_viridis_d() +
theme(axis.text.y = element_text(size = 22), axis.text.x = element_text(size = 22),
axis.title.y = element_text(size = 24), axis.title.x = element_text(size = 24),
legend.text = element_text(size = 18), legend.position="top") +
labs(x="Support status-quo", y="Efecto marginal de status quo") +
geom_hline(yintercept = 0, size=1.5)
View(plebs_1988)
mlogit_vote_sq_sex
grid <- plebs_1988 %>% data_grid(statusquo, sex, .model=mlogit_vote_sq_sex)
grid
grid <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex)
grid
plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex)
grid_delta <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex) %>% mutate(statusquo = statusquo + delta)
grid_delta
delta
-0.0456 + 0.1
predict(mlogit_vote_sq_sex, type="probs", newdata =grid)
predict(mlogit_vote_sq_sex, type="probs", newdata =grid) %>% as_tibble() %>%
mutate(id = row_number())%>% pivot_longer(-id, names_to="vote", values_to="prob")
predict(mlogit_vote_sq_sex, type="probs", newdata =grid_delta) %>% as_tibble() %>%
mutate(id = row_number())%>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
grid <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex)
grid_delta <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex) %>% mutate(statusquo = statusquo + delta)
p_hat <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid) %>% as_tibble() %>%
mutate(id = row_number())%>% pivot_longer(-id, names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid_delta) %>% as_tibble() %>%
mutate(id = row_number())%>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta
predict(mlogit_vote_sq_sex, type="probs", newdata =grid) %>% as_tibble()
p_hat <- grid %>% mutate(prob = predict(mlogit_vote_sq_sex, type="probs", newdata grid)
p_hat <- grid %>% mutate(prob = predict(mlogit_vote_sq_sex, type="probs", newdata=grid)
p_hat
grid %>% mutate(prob = predict(mlogit_vote_sq_sex, type="probs", newdata=grid))
grid
grid <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex)
grid_delta <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex) %>% mutate(statusquo = statusquo + delta)
p_hat <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid) %>% as_tibble() %>%
mutate(id = c("F","M"))%>% pivot_longer(-id, names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid_delta) %>% as_tibble() %>%
mutate(id = c("F","M"))%>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
grid <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex)
grid_delta <- plebs_1988 %>% data_grid(sex, .model=mlogit_vote_sq_sex) %>% mutate(statusquo = statusquo + delta)
p_hat <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid) %>% as_tibble() %>%
mutate(id = c("F","M"))%>% pivot_longer(-id, names_to="vote", values_to="prob")
p_hat_delta <- predict(mlogit_vote_sq_sex, type="probs", newdata =grid_delta) %>% as_tibble() %>%
mutate(id = c("F","M")) %>% pivot_longer(-id, names_to="vote", values_to="prob_delta")
p_hat_delta
p_hat_delta <- p_hat_delta %>% left_join(p_hat, by=c("id","vote")) %>% mutate(me_sq = (prob_delta  - prob)/delta) %>% dplyr::select(id,vote,me_sq) %>% pivot_wider(names_from = "vote", values_from = "me_sq") %>% drop_na()
p_hat_delta
xaringan:::inf_mr()
xaringan:::inf_mr()
dmultinom(100,)
dmultinom(c(2,2,2,2,2,2),size=12,p=rep(1-))
dmultinom(c(2,2,2,2,2,2),size=12,p=rep(1/6,6))
dmultinom(c(2,2,2,2,2,2),size=10,p=rep(1/6,6))
dmultinom(c(2,2,2,2,2,2),size=12,p=rep(1/6,6))
1/6
xaringan:::inf_mr()
xaringan:::inf_mr()
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(region),  shape=factor(sexo)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Región")
g
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot,  shape=factor(sexo)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Región")
g
install.packages("wesanderson")
xaringan:::inf_mr()
install.packages("wesanderson")
library("wesanderson")
?wesanderson
?wesanderson
?`wesanderson-package`
data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="GrandBudapest")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
library(wesanderson)
data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="GrandBudapest")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="GrandBudapest2")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="GrandBudapest2")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Zissou") +
facet_grid( . ~sexo)
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="Zissou")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
wes_palette()
wes_palettes
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=3, name="Zissou1")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
g
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=2, name="Zissou1")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
g
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
scale_color_manual(values=wes_palette(n=2, name="Darjeeling1")) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo)
g
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo) +
scale_color_manual(values=wes_palette(n=2, name="Darjeeling1")) +
theme_classic()
g
g <- data_ineq %>% ggplot() +
aes(x=gini_yaut, y=gini_ytot, color=factor(sexo),  shape=factor(sexo)) +
geom_point(alpha=0.5) +
geom_smooth(method = "lm", se=FALSE) +
geom_density2d(alpha=0.5) +
labs(x="Gini Ingreso autónomo indiv.", y="Gini Ingreso total indiv.", title = "Redistribución de ingresos por región",shape = "Sexo", color = "Sexo") +
facet_grid( . ~sexo) +
scale_color_manual(values=wes_palette(n=2, name="Darjeeling1")) +
theme_bw()
g
xaringan:::inf_mr()
minimal_theme <- theme_bw() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Fira Mono"),
plot.background = element_rect(fill = "#FAFAFA", color = NA),
panel.background = element_rect(fill = "#FAFAFA", color = NA)
)
library("cowplot")
minimal_theme <- theme_bw() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Fira Mono"),
plot.background = element_rect(fill = "#FAFAFA", color = NA),
panel.background = element_rect(fill = "#FAFAFA", color = NA)
)
set.seed(4242)
df_geom <- data_frame(y = rnorm(10), x = 1:10)
g_geom <- list()
g_geom$point <- ggplot(df_geom, aes(x, y)) + geom_point() + ggtitle("geom_point()")
g_geom$line <- ggplot(df_geom, aes(x, y)) + geom_line() + ggtitle("geom_line()")
g_geom$bar <- ggplot(df_geom, aes(x, y)) + geom_col() + ggtitle("geom_col()")
g_geom$boxplot <- ggplot(df_geom, aes(y = y)) + geom_boxplot() + ggtitle("geom_boxplot()")
g_geom$histogram <- ggplot(df_geom, aes(y)) + geom_histogram(binwidth = 1) + ggtitle("geom_histogram()")
g_geom$density <- ggplot(df_geom, aes(y)) + geom_density(fill = "grey40", alpha = 0.25) + ggtitle("geom_density()") + xlim(-4, 4)
g_geom <- map(g_geom, ~ . + minimal_theme)
cowplot::plot_grid(plotlist = g_geom)
minimal_theme <- theme_bw() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Fira Mono"),
plot.background = element_rect(fill = "#FAFAFA", color = NA),
panel.background = element_rect(fill = "#FAFAFA", color = NA)
)
set.seed(4242)
df_geom <- data_frame(y = rnorm(10), x = 1:10)
g_geom <- list()
g_geom$point <- ggplot(df_geom, aes(x, y)) + geom_point() + ggtitle("geom_point()")
g_geom$line <- ggplot(df_geom, aes(x, y)) + geom_line() + ggtitle("geom_line()")
g_geom$bar <- ggplot(df_geom, aes(x, y)) + geom_col() + ggtitle("geom_col()")
g_geom$boxplot <- ggplot(df_geom, aes(y = y)) + geom_boxplot() + ggtitle("geom_boxplot()")
g_geom$histogram <- ggplot(df_geom, aes(y)) + geom_histogram(binwidth = 1) + ggtitle("geom_histogram()")
df_geom <- data_frame(y = rnorm(10), x = 1:10)
g_geom <- list()
g_geom$point <- ggplot(df_geom, aes(x, y)) + geom_point() + ggtitle("geom_point()")
g_geom$line <- ggplot(df_geom, aes(x, y)) + geom_line() + ggtitle("geom_line()")
g_geom$bar <- ggplot(df_geom, aes(x, y)) + geom_col() + ggtitle("geom_col()")
g_geom$boxplot <- ggplot(df_geom, aes(y = y)) + geom_boxplot() + ggtitle("geom_boxplot()")
g_geom$histogram <- ggplot(df_geom, aes(y)) + geom_histogram(binwidth = 1) + ggtitle("geom_histogram()")
g_geom$density <- ggplot(df_geom, aes(y)) + geom_density(fill = "grey40", alpha = 0.25) + ggtitle("geom_density()") + xlim(-4, 4)
g_geom <- map(g_geom, ~ . + minimal_theme)
cowplot::plot_grid(plotlist = g_geom)
# Limpiar pantalla y remover objetos existentes
cat("\014")
rm(list = ls())
## Bases de datos ordenadas ("tidy")
library("tidyverse")
library("ineq")
setwd(
"~/Library/Mobile Documents/com~apple~CloudDocs/Teaching/ISUC/2020_2_data_analysis_r/repo/slides/class_5/")
# leer archivo csv
data_casen_csv <- read_csv("sample_casen2017.csv")
data_casen_csv %>% glimpse()
data_ineq <- data_casen_csv %>%
group_by(comuna,sexo) %>%
summarise(gini_ytot=Gini(ytotcor,na.rm = T), gini_yaut=Gini(yautcor,na.rm = T))
# Construir gráfico en layers
data_ineq %>%
ggplot(
aes(x=gini_yaut, y=gini_ytot, group = factor(sexo),  colour = factor(sexo), shape = factor(sexo))) +
geom_point()  +
geom_smooth(se=F) +
labs(x="Gini Ingreso autónomo indiv.",  y="Gini Ingreso total indiv.",
title = "Redistribución de ingresos por región", shape = "Sexo", color = "Sexo")
